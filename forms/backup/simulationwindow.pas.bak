unit SimulationWindow;

{$mode objfpc}{$H+}

interface

uses
  Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs, StdCtrls,
  ExtCtrls, Buttons, ComCtrls,
  world, sim;

type

  { TForm2 }

  TForm2 = class(TForm)
    BitBtn1: TBitBtn;
		Edit1: TEdit;
		Image1: TImage;
		Image2: TImage;
		ImageList1: TImageList;
		Label1: TLabel;
		LabeledEdit1: TLabeledEdit;
		LabeledEdit2: TLabeledEdit;
    Memo1: TMemo;
		Timer1: TTimer;
		TrackBar1: TTrackBar;
    procedure BitBtn1Click(Sender: TObject);
		procedure Edit1Change(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure FormDestroy(Sender: TObject);
		procedure Image1Resize(Sender: TObject);
		procedure Timer1Timer(Sender: TObject);
		procedure TrackBar1Change(Sender: TObject);
  private
    { private declarations }
    FDuration: Integer;

  public
    FSim: TSimulation;

  end;

var
  Form2: TForm2;

implementation

{$R *.lfm}

{ TForm2 }

procedure TForm2.BitBtn1Click(Sender: TObject);
var
  x,y: Integer;
begin
  x := StrToInt(LabeledEdit1.Text);
  y := StrToInt(LabeledEdit2.Text);
  FSim.Map.Generate(x, y);
  Memo1.Clear;
  Memo1.Lines.AddStrings(FSim.Map.ToText);
  FSim.Map.ToImage(Image1, ImageList1);
end;

procedure TForm2.Edit1Change(Sender: TObject);
begin
  if TryStrToInt(Edit1.Text, FDuration) then
  begin
    Trackbar1.Position := FDuration;
    Timer1.Interval := FDuration;
	end;
end;

procedure TForm2.FormCreate(Sender: TObject);
begin
  FSim := TSimulation.Create;
  FSim.Map.TileSize := 8;
  FDuration := 3000;
  Trackbar1.Position := FDuration;
  Edit1.Text := IntToStr(FDuration);
end;

procedure TForm2.FormDestroy(Sender: TObject);
begin
  FSim.Free;
end;

procedure TForm2.Image1Resize(Sender: TObject);
begin
  Image1.Picture.Bitmap.SetSize(Image1.Width, Image1.Height);
end;

procedure TForm2.Timer1Timer(Sender: TObject);
begin
  if self.Visible then
  begin
    Image1.Picture.Bitmap.Clear;
    FSim.Map.ToImage(Image1, ImageList1);
	end;
end;

procedure TForm2.TrackBar1Change(Sender: TObject);
begin
  Edit1.Text := IntToStr(TrackBar1.Position);
end;


end.

